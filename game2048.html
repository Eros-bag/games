<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>2048 - Gamers</title>
    <link rel="stylesheet" href="../style.css">
    <style>
        body { text-align: center; background: #faf8ef; color: #776e65; }
        #game-container { margin: 50px auto; width: 400px; }
        .tile {
            width: 90px; height: 90px; margin: 5px;
            display: inline-block;
            background: #cdc1b4;
            line-height: 90px;
            font-size: 32px;
            font-weight: bold;
            color: #776e65;
            border-radius: 5px;
        }
        .row { margin-bottom: 5px; }
    </style>
</head>
<body>

<h2>ðŸ”¢ 2048</h2>
<div id="game-container"></div>
<div id="score">Score : 0</div>

<script>
let grid = [
    [0,0,0,0],
    [0,0,0,0],
    [0,0,0,0],
    [0,0,0,0]
];
let score = 0;

// Initialiser deux tuiles
function addRandomTile() {
    let empty = [];
    for (let r=0;r<4;r++)
        for (let c=0;c<4;c++)
            if(grid[r][c]==0) empty.push({r,c});
    if(empty.length===0) return;
    let {r,c} = empty[Math.floor(Math.random()*empty.length)];
    grid[r][c] = Math.random()<0.9?2:4;
}
addRandomTile();
addRandomTile();

// Affichage
function drawGrid() {
    const container = document.getElementById("game-container");
    container.innerHTML = "";
    for(let r=0;r<4;r++){
        let row = document.createElement("div");
        row.className = "row";
        for(let c=0;c<4;c++){
            let tile = document.createElement("div");
            tile.className = "tile";
            if(grid[r][c]>0) tile.innerText = grid[r][c];
            row.appendChild(tile);
        }
        container.appendChild(row);
    }
    document.getElementById("score").innerText = "Score : " + score;
}

// DÃ©placer et fusionner
function move(dir){
    let moved = false;
    function combine(a,b){ 
        if(a===0) return b;
        if(a===b){ score+=a*2; return a*2; }
        return a;
    }
    let prev = JSON.stringify(grid);
    for(let r=0;r<4;r++){
        let line = dir==="left"?grid[r]: dir==="right"?grid[r].slice().reverse() : dir==="up"?[grid[0][r],grid[1][r],grid[2][r],grid[3][r]] : [grid[0][r],grid[1][r],grid[2][r],grid[3][r]].reverse();
        line = line.filter(n=>n!==0);
        for(let i=0;i<line.length-1;i++) if(line[i]===line[i+1]) { line[i]*=2; line[i+1]=0; }
        line = line.filter(n=>n!==0);
        while(line.length<4) line.push(0);
        if(dir==="right"||dir==="down") line.reverse();
        if(dir==="left"||dir==="right") grid[r]=line;
        else for(let i=0;i<4;i++) grid[i][r]=line[i];
    }
    if(prev!==JSON.stringify(grid)) moved=true;
    if(moved) addRandomTile();
    drawGrid();
    checkGameOver();
}

// DÃ©tection Game Over
function checkGameOver() {
    for(let r=0;r<4;r++)
        for(let c=0;c<4;c++)
            if(grid[r][c]===0) return;
    for(let r=0;r<4;r++)
        for(let c=0;c<3;c++)
            if(grid[r][c]===grid[r][c+1] || grid[c][r]===grid[c+1][r]) return;
    gameOver();
}

// Gestion Game Over
function gameOver() {
    let lives = parseInt(sessionStorage.getItem("lives")) || 0;
    if(lives<5){
        if(confirm("ðŸ’€ Game Over ! Score : " + score + "\nðŸ“º Regarder une pub pour rÃ©cupÃ©rer une vie ?")){
            simulateAd2048();
        } else window.location.href="../index.html";
    } else {
        alert("ðŸ’€ Game Over ! Score : " + score);
        window.location.href="../index.html";
    }
}

// Simulation pub rÃ©compensÃ©e
function simulateAd2048() {
    alert("ðŸŽ¬ PublicitÃ© en cours... (simulation 3 secondes)");
    setTimeout(()=>{
        let lives = parseInt(sessionStorage.getItem("lives")) || 0;
        lives++;
        sessionStorage.setItem("lives", lives);
        alert("âœ… +1 vie ajoutÃ©e ! Tu peux rejouer.");
        window.location.reload();
    },3000);
}

// ContrÃ´le clavier
document.addEventListener("keydown", (e)=>{
    if(e.key==="ArrowLeft") move("left");
    if(e.key==="ArrowRight") move("right");
    if(e.key==="ArrowUp") move("up");
    if(e.key==="ArrowDown") move("down");
});

// Initial draw
drawGrid();
</script>

</body>
</html>