<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Flappy - Gamers</title>
    <link rel="stylesheet" href="../style.css">
    <style>
        canvas {
            background: #70c5ce;
            display: block;
            margin: 50px auto;
            border: 2px solid #3498db;
        }
        #score {
            text-align: center;
            font-size: 24px;
            margin-top: 20px;
        }
    </style>
</head>
<body>

<h2>üê¶ Flappy Bird-like</h2>
<canvas id="flappyCanvas" width="400" height="500"></canvas>
<div id="score">Score : 0</div>

<script>
const canvas = document.getElementById("flappyCanvas");
const ctx = canvas.getContext("2d");

const gravity = 0.5;
let bird = { x: 50, y: 250, width: 20, height: 20, dy: 0 };
let pipes = [];
let frame = 0;
let score = 0;

// G√©n√©rer des pipes
function createPipe() {
    let gap = 120;
    let heightTop = Math.floor(Math.random() * (canvas.height - gap - 50)) + 20;
    pipes.push({
        x: canvas.width,
        y: 0,
        width: 40,
        height: heightTop
    });
    pipes.push({
        x: canvas.width,
        y: heightTop + gap,
        width: 40,
        height: canvas.height - heightTop - gap
    });
}

// Game loop
function loop() {
    requestAnimationFrame(loop);
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // Bird
    bird.dy += gravity;
    bird.y += bird.dy;
    ctx.fillStyle = "yellow";
    ctx.fillRect(bird.x, bird.y, bird.width, bird.height);

    // Pipes
    if (frame % 90 === 0) createPipe();
    for (let i = pipes.length - 1; i >= 0; i--) {
        let pipe = pipes[i];
        pipe.x -= 2;
        ctx.fillStyle = "green";
        ctx.fillRect(pipe.x, pipe.y, pipe.width, pipe.height);

        // Collision
        if (bird.x < pipe.x + pipe.width && bird.x + bird.width > pipe.x &&
            bird.y < pipe.y + pipe.height && bird.y + bird.height > pipe.y) {
            gameOver();
            return;
        }

        // Score
        if (pipe.x + pipe.width === bird.x) {
            score++;
            document.getElementById("score").innerText = "Score : " + Math.floor(score/2);
        }

        // Supprimer pipes hors canvas
        if (pipe.x + pipe.width < 0) pipes.splice(i, 1);
    }

    // Collision sol ou plafond
    if (bird.y + bird.height > canvas.height || bird.y < 0) {
        gameOver();
        return;
    }

    frame++;
}

// Contr√¥le
document.addEventListener("keydown", () => { bird.dy = -7; });
canvas.addEventListener("click", () => { bird.dy = -7; });

// Game Over
function gameOver() {
    cancelAnimationFrame(loop);
    let lives = parseInt(sessionStorage.getItem("lives")) || 0;

    if (lives < 5) {
        if (confirm("üíÄ Game Over ! Score : " + Math.floor(score/2) + "\nüì∫ Regarder une pub pour r√©cup√©rer une vie ?")) {
            simulateAdFlappy();
        } else {
            window.location.href = "../index.html";
        }
    } else {
        alert("üíÄ Game Over ! Score : " + Math.floor(score/2));
        window.location.href = "../index.html";
    }
}

// Simulation pub r√©compens√©e
function simulateAdFlappy() {
    alert("üé¨ Publicit√© en cours... (simulation 3 secondes)");
    setTimeout(() => {
        let lives = parseInt(sessionStorage.getItem("lives")) || 0;
        lives++;
        sessionStorage.setItem("lives", lives);
        alert("‚úÖ +1 vie ajout√©e ! Tu peux rejouer.");
        window.location.reload();
    }, 3000);
}

requestAnimationFrame(loop);
</script>

</body>
</html>